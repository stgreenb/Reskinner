<!-- OPENSPEC:START -->
# OpenSpec Instructions

These instructions are for AI assistants working in this project.

Always open `@/openspec/AGENTS.md` when the request:
- Mentions planning or proposals (words like proposal, spec, change, plan)
- Introduces new capabilities, breaking changes, architecture shifts, or big performance/security work
- Sounds ambiguous and you need the authoritative spec before coding

Use `@/openspec/AGENTS.md` to learn:
- How to create and apply change proposals
- Spec format and conventions
- Project structure and guidelines

Keep this managed block so 'openspec update' can refresh the instructions.

<!-- OPENSPEC:END -->

## Critical: Foundry VTT Module Validation

**Every implementation must validate that all files referenced in `module.json` exist and are properly built:**

- [ ] **Check `esmodules` entries** (e.g., `ds-reskinner.mjs`) are generated by build process
- [ ] **Check `styles` entries** (e.g., `css/module.css`) are available  
- [ ] **Check `templates` entries** exist in correct directory structure
- [ ] **Check `languages` entries** exist and are properly formatted
- [ ] **Run build process**: `npm run build` to generate required files
- [ ] **Validate file paths**: Ensure all paths in `module.json` match actual file locations
- [ ] **Test module loading**: Verify Foundry VTT can load the module without metadata validation errors

**Common Issues & Solutions:**
- **Missing `ds-reskinner.mjs`** → Run `npm run build` 
- **Build tool dependency conflicts** → Check `package.json` and fix incompatible versions
- **Missing CSS/Template files** → Verify rollup copy configuration
- **Path misalignment** → Update module.json to match generated file structure

**Learned from Experience**: The error `"Metadata validation failed for module "ds-reskinner": The file "ds-reskinner.mjs" included by module ds-reskinner does not exist"` occurred because the build process wasn't run to generate the bundled JavaScript file that Foundry VTT expects.

**Critical: Single Source of Truth for Versioning**

**ONLY `package.json` version should be updated manually.** The build process automatically propagates this version to all other locations:

- ✅ **Manual**: Update version in `package.json` only
- ✅ **Automatic**: Build process updates `module.json` from `package.json`
- ✅ **Automatic**: Build process injects version into JavaScript bundle
- ❌ **Never**: Manually edit `module.json` version (will be overwritten)
- ❌ **Never**: Add version comments to source files (redundant)

**Version Update Workflow:**
1. Increment version in `package.json` (semantic versioning: MAJOR.MINOR.PATCH)
2. Run `npm run build` to propagate version changes
3. Verify build output shows version update confirmation
4. Test and deploy

This consolidation eliminates version inconsistencies and ensures all components use the same version identifier.

Note USER will upload the module to Foundry VTT, so we must ensure all files are properly built and referenced and wait for the user to confirm the server has been updated and restarted. 